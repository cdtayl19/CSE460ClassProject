<!DOCTYPE html>
<head>
    <title>Club Page</title>
</head>

<body>
    <div class="starter-container">
        
        <div id="info">
            <!-- Store club name -->
            <h1 id="name" data-name="{{ club['Club Name'] }}">
                {{ club["Club Name"] }}
            </h1>
            
            <!-- Store leader -->
            <p id="leader" data-name="{{ club['Leader'] }}">
                <strong>Leader:</strong> 
                {{ club["Leader"] }}
            </p>

            <p><strong>Topic:</strong> {{ club["Topic"] }}</p>
            <p><strong>Details:</strong> {{ club["Details"] }}</p>
            <p><strong>Members:</strong> {{ club["Members"] }}</p>
            <p><strong>Events:</strong> {{ club["Events"] }}</p>
        </div>

        

        <div id="studentButtons">
            <button id="join">Request to Join!</button>
        </div><br>

        <div id="leaderButtons">
            <div id="joinRequests">
                <label id="requests">You have {} new requests. </label>
			    <button id="viewBtn">View</button>
            </div><br>
            <button id="createEventBtn">Create Event</button>
        </div><br>

        <div>
            <button id="backBtn">Back</button>
        </div>

        
        
    </div>

    <script>
        let user = {};

        window.addEventListener("DOMContentLoaded", async () => {
            // Get the current user
            let response = await fetch("/current-user", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
        
            let data = await response.json();
            user = data.user;
            
            
            let clubName = document.getElementById("name").dataset.name;
            let leader = document.getElementById("leader").dataset.name;

            const studentButtons = document.getElementById("studentButtons");
            const leaderButtons = document.getElementById("leaderButtons");

            if (user.Username === leader) {
                studentButtons.style.display = "none";
                leaderButtons.style.display = "block";
            } else {
                studentButtons.style.display = "block";
                leaderButtons.style.display = "none";
            }

            // Get the number of join requests
            response = await fetch(`/get-join-requests?club=${clubName}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
            
            data = await response.json();
            requestNum = data.number;
            document.getElementById("requests").innerHTML = "You have " + requestNum + " new requests.";
        });

        document.getElementById("join").addEventListener("click", async () => {

            let response = await fetch("/current-user", {
                method: "GET",
				headers: {
                    "Content-Type": "application/json"
                }
            });

            let data = await response.json();
            
            user = data.user;   
            
            let clubName = document.getElementById("name").dataset.name;
            let leader = document.getElementById("leader").dataset.name;
            
            const joinReq = {user, leader, clubName}; 

            fetch("/send-join-request", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(joinReq)
            })
            
            document.getElementById("studentButtons").innerHTML = "Your request to join has been sent!";

        });

        document.getElementById("backBtn").addEventListener("click", () => {
            window.location.href = '/browse-clubs';
        });

        document.getElementById("viewBtn").addEventListener("click", () => {
            let clubName = document.getElementById("name").dataset.name;
            window.location.href = `/view-join-requests?club=${clubName}`;
        })

        document.getElementById("createEventBtn").addEventListener("click", () => {
            let clubName = document.getElementById("name").dataset.name;
            window.location.href = `/create-event?club=${clubName}`;
        });
    </script>
</body>
</html>