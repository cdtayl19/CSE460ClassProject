<!DOCTYPE html>
<head>
    <title>Event Page</title>
</head>

<body>
    <div class="starter-container">
        
        <div id="info">
            <!-- Store event name -->
            <h1 id="name" data-name="{{ event['Event Name'] }}">
                {{ event["Event Name"] }}
            </h1>
            
            <!-- Store host -->
            <p id="host" data-name="{{ event['Club Name'] }}">
                <strong>Host:</strong> 
                {{ event["Club Name"] }}
            </p>

            <p><strong>Date:</strong> {{ event["Date"] }}</p>
            <p><strong>Time:</strong> {{ event["Time"] }}</p>
            <p><strong>Location:</strong> {{ event["Location"] }}</p>
            <p><strong>Description:</strong> {{ event["Description"] }}</p>
            
            <div>
                <strong>Availability:</strong>
                <span  id="availability">There are {{ event["Max Guests"] }} spots available.</span>
            </div><br>
            
        </div>

        

        
        <button id="register">Register for Event!</button><br>

        <div id="leaderButtons">
            <!-- NEED TO ADD EDIT BUTTONS for LEADER -->
        </div><br>

        <div>
            <button id="backBtn">Back</button>
        </div>
    </div>

    <script>
        let user = {};

        window.addEventListener("DOMContentLoaded", async () => {
            // Get the current user
            let response = await fetch("/current-user", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
        
            let data = await response.json();
            user = data.user;
                        
            let eventName = document.getElementById("name").dataset.name;

            const leaderButtons = document.getElementById("leaderButtons");

            //if (user.Username === leader) {
            //    leaderButtons.style.display = "block";
            //}

            // Get the number of Registered Guests
            response = await fetch(`/get-registered-guests?event=${eventName}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            });
            
            data = await response.json();
            maxNum = data.max
            guestNum = data.number;
            console.log("Max: " + maxNum + ", Num: " + guestNum);
            document.getElementById("availability").innerHTML = "There are " + (maxNum - guestNum) + " spots available.";
        });

        document.getElementById("register").addEventListener("click", async () => {

            let response = await fetch("/current-user", {
                method: "GET",
				headers: {
                    "Content-Type": "application/json"
                }
            });

            let data = await response.json();
            
            user = data.user;   
            
            let eventName = document.getElementById("name").dataset.name;
            
            const registerReq = {user, eventName}; 

            fetch("/register-guest", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(registerReq)
            })
            
            document.getElementById("register").innerHTML = "You have registered for " + eventName + "!";

        });

        document.getElementById("backBtn").addEventListener("click", () => {
            window.location.href = '/browse-events';
        });

        /*document.getElementById("viewBtn").addEventListener("click", () => {
            let clubName = document.getElementById("name").dataset.name;
            window.location.href = `/view-join-requests?club=${clubName}`;
        })*/

        /*document.getElementById("createEventBtn").addEventListener("click", () => {
            let clubName = document.getElementById("name").dataset.name;
            window.location.href = `/create-event?club=${clubName}`;
        });*/
    </script>
</body>
</html>